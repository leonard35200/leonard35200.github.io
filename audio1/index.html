<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>57 rue du soleil</title>
<style>
body { font-family:sans-serif; margin:0; background:#f6f6f6; color:#333; text-align:center; }
h1 { background:black; color:white; margin:0; padding:1em; }

#imagePlay { width:200px; height:200px; margin:40px auto; cursor:pointer; object-fit:cover; display:block; }

#playerUI { display:none; margin-top:20px; }
#progressContainer { position:relative; width:80%; max-width:600px; height:15px; background:#ddd; border-radius:10px; margin:20px auto; cursor:pointer; overflow:hidden; }
#progressBar { height:100%; width:0%; background:linear-gradient(90deg,#4a90e2,#7b4397); border-radius:10px; transition:width 0.2s linear; }
#volumeContainer { display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:10px; }
#chapter { font-size:1.1em; margin-bottom:20px; font-weight:bold; }
input[type="range"] { width:100px; }
.time { display:flex; justify-content:space-between; width:80%; max-width:600px; font-size:0.9em; margin:5px auto; opacity:0.8; }
button { margin:5px; padding:8px 16px; font-size:1em; border:none; border-radius:20px; cursor:pointer; background:black; color:white; }
button:hover { background:#222; }
.progress-pulse { animation:pulse 2s infinite; }
@keyframes pulse { 0% { box-shadow:0 0 5px #4a90e2; } 50% { box-shadow:0 0 15px #7b4397; } 100% { box-shadow:0 0 5px #4a90e2; } }
</style>
</head>
<body>
<h1>Audio 57 rue du soleil</h1>
<img src="audio.png" id="imagePlay" alt="Lire / mettre en pause le livre audio" role="button" tabindex="0">

<div id="playerUI">
  <div id="progressContainer" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
    <div id="progressBar" aria-hidden="true"></div>
  </div>

  <div class="time">
    <span id="currentTime">0:00</span>
    <span id="remainingTime">-3:52</span>
  </div>
  <div id="volumeContainer">üîä <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="1"></div>
  <div id="chapter">Chapitre 0</div>
  <button id="prevChapterBtn">Chapitre pr√©c√©dent ‚èÆÔ∏è</button>
  <button id="pauseBtn">‚ñ∂Ô∏è</button>
  <button id="nextChapterBtn">Chapitre suivant ‚è≠Ô∏è</button>
  <button id="rewindBtn">‚è™ 15s</button>
  <button id="forwardBtn">15s ‚è©</button>
</div>

<audio id="audioPlayer"></audio>

<script>
const files = ['livre_audio.mp3','livre_audio1.mp3','livre_audio2.mp3','livre_audio3.mp3'];
const chapterDuration = 58; // chaque fichier = 58s
const totalDuration = files.length * chapterDuration;

const player = document.getElementById('audioPlayer');
const imagePlay = document.getElementById('imagePlay');
const playerUI = document.getElementById('playerUI');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const volumeControl = document.getElementById('volumeControl');
const chapterEl = document.getElementById('chapter');
const currentTimeEl = document.getElementById('currentTime');
const remainingTimeEl = document.getElementById('remainingTime');
const pauseBtn = document.getElementById('pauseBtn');
const prevChapterBtn = document.getElementById('prevChapterBtn');
const nextChapterBtn = document.getElementById('nextChapterBtn');
const rewindBtn = document.getElementById('rewindBtn');
const forwardBtn = document.getElementById('forwardBtn');

let currentIndex = parseInt(localStorage.getItem('audioIndex')) || 0;
let lastPosition = parseFloat(localStorage.getItem('audioTime')) || 0;
let hasStarted = false;

player.volume = parseFloat(volumeControl.value);

// format temps
function formatTime(sec){
  const m = Math.floor(sec/60);
  const s = Math.floor(sec%60);
  return m+":"+s.toString().padStart(2,'0');
}

// update barre et temps
function updateProgress(){
  const elapsed = currentIndex*chapterDuration + (player.currentTime||0);
  const percent = Math.min(elapsed/totalDuration,1)*100;
  progressBar.style.width = percent+"%";
  currentTimeEl.textContent = formatTime(elapsed);
  remainingTimeEl.textContent = "-"+formatTime(Math.max(totalDuration-elapsed,0));
}

// charger et jouer un chapitre
function loadTrack(index,startTime=0){
  if(index>=files.length){
    chapterEl.textContent="Fin du livre";
    progressBar.style.width="100%";
    currentTimeEl.textContent = formatTime(totalDuration);
    remainingTimeEl.textContent="-0:00";
    return;
  }
  player.src = files[index];
  player.currentTime = startTime;
  chapterEl.textContent = "Chapitre "+index;
  player.play().catch(()=>{}); // autoplay mobile-friendly
  hasStarted = true;
  playerUI.style.display = "block";
}

// clic sur image = toggle play/pause
imagePlay.addEventListener('click',()=>{
  if(!hasStarted) loadTrack(currentIndex,lastPosition);
  else player.paused ? player.play() : player.pause();
});

// toggle pause bouton
pauseBtn.addEventListener('click', ()=>{
  if(player.paused){ player.play(); }
  else { player.pause(); }
});

// chapitres
prevChapterBtn.addEventListener('click', ()=>{ if(currentIndex>0){currentIndex--; loadTrack(currentIndex,0); }});
nextChapterBtn.addEventListener('click', ()=>{ if(currentIndex<files.length-1){currentIndex++; loadTrack(currentIndex,0); }});

// +/-15s
rewindBtn.addEventListener('click', ()=>{ player.currentTime = Math.max(0,player.currentTime-15); });
forwardBtn.addEventListener('click', ()=>{ player.currentTime = Math.min(chapterDuration,player.currentTime+15); });

// volume
volumeControl.addEventListener('input',e=>{ player.volume = parseFloat(e.target.value); });

// mise √† jour continue
player.addEventListener('timeupdate', updateProgress);
player.addEventListener('timeupdate', ()=>{
  localStorage.setItem('audioTime',player.currentTime);
  localStorage.setItem('audioIndex',currentIndex);
});

// fin d‚Äôun chapitre -> suivant auto
player.addEventListener('ended', ()=>{
  currentIndex++;
  lastPosition=0;
  localStorage.setItem('audioIndex',currentIndex);
  localStorage.setItem('audioTime',0);
  loadTrack(currentIndex,0);
});

// clic barre pour sauter
progressContainer.addEventListener('click',e=>{
  const rect = progressContainer.getBoundingClientRect();
  const ratio = (e.clientX - rect.left)/rect.width;
  const targetTime = ratio*totalDuration;
  currentIndex = Math.floor(targetTime/chapterDuration);
  const offset = targetTime - currentIndex*chapterDuration;
  loadTrack(currentIndex, offset);
});

// pause si page inactive
document.addEventListener('visibilitychange',()=>{ if(document.hidden) player.pause(); });

// sauvegarde avant fermeture
window.addEventListener('beforeunload',()=>{
  localStorage.setItem('audioTime',player.currentTime);
  localStorage.setItem('audioIndex',currentIndex);
});
</script>
</body>
</html>