<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Où est ma salle ? — Lycée Zola</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f1220; --ink:#e9ecf1; --muted:#a9b0c6;
  --accent:#7dd3fc; --accent-2:#a78bfa;
  --radius:18px; --shadow:0 10px 25px rgba(2,6,23,.55);
  --route-color:#22c55e;
}
*{box-sizing:border-box}
html,body{min-height:100%;}
body {
  margin: 32px;
  font-family: Inter,system-ui,Segoe UI,Roboto,sans-serif;
  color: var(--ink);
  background: radial-gradient(1000px 600px at 15% 10%, #1b1f36 0%, #121528 40%, #0d1022 100%) , var(--bg);
  display: block;
  min-height: 100vh;
}
.wrap {
  width: min(920px, 92vw);
  display: grid;
  gap: 18px;
  margin: 0 auto; /* <-- centre horizontalement */
}
header{display:flex; gap:14px; justify-content:center; align-items:center;}
h1{margin:0; font-size:clamp(22px,3vw,30px);}
.logo{width:44px; height:44px; border-radius:12px;
  background:conic-gradient(from 200deg,var(--accent),var(--accent-2),#60a5fa,var(--accent));
  box-shadow:0 6px 28px rgba(124,58,237,.35);}
.card{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius); padding:22px; box-shadow:var(--shadow);}
label{display:block; font-weight:600; margin-bottom:8px; color:var(--muted);}
input{width:100%; padding:14px 16px; font-size:16px; color:var(--ink);
  background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);
  border-radius:14px; outline:none; transition:.2s;}
input:focus{border-color:var(--accent); box-shadow:0 0 0 6px rgba(125,211,252,.12);}
.grid{display:grid; gap:14px;}
@media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
.actions{display:flex; gap:10px; margin-top:14px}
button{padding:12px 16px; border-radius:14px; border:0; cursor:pointer;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:#0b1020; font-weight:700;}
.ghost{background:transparent; border:1px dashed rgba(255,255,255,.18); color:var(--ink);}
.result,.error{border-radius:16px; padding:16px; line-height:1.5;}
.result{background:rgba(34,197,94,.08); border:1px solid rgba(34,197,94,.35)}
.error{background:rgba(239,68,68,.08); border:1px solid rgba(239,68,68,.35)}

/* Plan absolu avec couloirs centrés et espacement */
.map-container{position:relative; width:280px; height:260px; margin:auto;}
.stair{
  background: var(--accent);
  color:#0b1020;
  font-weight:bold;
  display:flex; align-items:center; justify-content:center;
  border-radius:10px;
  width:40px; height:40px;
  position:absolute;
  transition:.3s;
  z-index:2;
}
.corridor{
  position:absolute;
  background:var(--muted);
  transition:.3s;
  z-index:1;
}
.corridor.horizontal{height:10px; top:50%; transform:translateY(-50%);}
.corridor.vertical{width:10px; left:50%; transform:translateX(-50%);}
.route{background:var(--route-color) !important;}
@keyframes moveArrow{
  0%{background-position:0 0;}
  100%{background-position:20px 0;}
}
.corridor.route.horizontal{
  background: repeating-linear-gradient(90deg, var(--route-color), var(--route-color) 10px, transparent 10px, transparent 20px);
  animation: moveArrow 0.5s linear infinite;
}
.corridor.route.vertical{
  background: repeating-linear-gradient(180deg, var(--route-color), var(--route-color) 10px, transparent 10px, transparent 20px);
  animation: moveArrow 0.5s linear infinite;
}

.result, .error {
  border-radius:16px; 
  padding:16px; 
  line-height:1.5;
  margin-bottom:12px; /* <- espace sous le cadre */
}
/* uniquement pour couloir TP svt et couloir TP physique chimie */


/* Ajoute une marge au-dessus du plan */
.map-container {
  margin-top: 36px; /* augmente la valeur si besoin */
}

.arrow {
  position: absolute;
  z-index: 3;
  font-size: 22px;
  pointer-events: none;
  color: var(--route-color);
  filter: drop-shadow(0 1px 2px #0008);
  transition: .3s;
}
.map-container .arrow {
  z-index: 100 !important;
  font-size: 32px !important;
  color: #fff !important;
  text-shadow: 0 0 4px #22c55e, 0 0 2px #000;
  pointer-events: none;
}
</style>
</head>
<body>
<div class="wrap">
  <header><div class="logo"></div><h1>Où est ma salle&nbsp;?</h1></header>

  <section class="card">
    <div class="grid">
      <div>
<label for="target">
  Je veux aller en salle :
  
</label>
        <input id="target" inputmode="numeric" placeholder="ex. 272, 334" />
      </div>
      <div>
        <label for="from">(optionnel) Je suis actuellement en salle :</label>
        <input id="from" inputmode="numeric" placeholder="ex. 201" />
      </div>
    </div>
    <div class="actions">
      <button id="go">Trouver</button>
      <button id="reset" class="ghost" type="button">Effacer</button>
    </div>
  </section>

  <section id="out"></section>

  <!-- Plan absolu corrigé -->
  <section class="map-container">
    <!-- Escaliers -->
    <div class="stair" id="G" style="top:0; left:0;">G</div>
    <div class="stair" id="O" style="top:0; left:120px;">O</div>
    <div class="stair" id="T" style="top:0; left:240px;">T</div>
    <div class="stair" id="E" style="top:100px; left:0;">E</div>
    <div class="stair" id="R" style="top:100px; left:120px;">R</div>
    <div class="stair" id="W" style="top:200px; left:120px;">W</div>

    <!-- Couloirs centrés -->
    <div class="corridor horizontal" id="G-O" style="top:20px; left:40px; width:80px;"></div>
    <div class="corridor horizontal" id="O-T" style="top:20px; left:160px; width:80px;"></div>
<!-- Couloir au-dessus de G-E (calé sur les autres) -->
<div class="corridor vertical" id="couloir TP svt" style="top:-30px; left:20px; height:60px;"></div>

<!-- Couloir G-E (calé sur les autres) -->
<div class="corridor vertical" id="G-E" style="top:40px; left:20px; height:60px;"></div>

<!-- Couloir en dessous de G-E (calé sur les autres) -->
<div class="corridor vertical" id="couloir TP physique chimie" style="top:140px; left:20px; height:60px;"></div>

    <div class="corridor vertical" id="O-R" style="top:40px; left:140px; height:60px;"></div>
    <div class="corridor horizontal" id="E-R" style="top:120px; left:40px; width:80px;"></div>
    <div class="corridor vertical" id="R-W" style="top:140px; left:140px; height:60px;"></div>
  </section>

  <footer style="text-align:center; margin-top:20px; font-size:14px; color:var(--muted);">
  &copy; 2025 Leonard Loquet — Tous droits réservés
</footer>

</div>

<script>
// Données salles
const data={
  2:[
    {rooms:[200,201,202,203],stairs:'W'},
    {rooms:[270,271,272],stairs:'R'},
    {rooms:[273,274,275],stairs:'E'},
    {rooms:[243,242],stairs:'G'},
    {rooms:[241,240],stairs:'O',cote:'droite'},
    {rooms:[253,254],stairs:'O',cote:'gauche'},
    {rooms:[252,250,251],stairs:'T'},
    {rooms:[234,233,232,231],stairs:'O',cote:'droite'},
  ],
  3:[
    {rooms:[300,301,302,303,304],stairs:'W'},
    {rooms:[370],stairs:'R'},
    {rooms:[371,372],stairs:'E'},
    {rooms:[343,344,342],stairs:'G'},
    {rooms:[334,333,332,331,340,341],stairs:'O',cote:'droite'},
    {rooms:[353,354,355,356],stairs:'O',cote:'gauche'},
    {rooms:[352,350,351],stairs:'T'},
  ],
  1:[
  {rooms:[140,141,142],stairs:'G-O'},
  {rooms:[155,154,153,152],stairs:'O-T'},
  {rooms:[174,173,172,171,170],stairs:'E-R'},
  {rooms:[117,116,115,114],stairs:'G-E'},
  {rooms:[160,161,162,163],stairs:'O-R'},
  {rooms:[],stairs:'R-W'}
]

};

data[1].push(
  { rooms: [122,121], stairs: 'couloir TP svt' },    // salles au-dessus de G-E
  { rooms: [110,111,112,113], stairs: 'couloir TP physique chimie' } // salles en dessous de G-E
);


// Graphe escaliers et couloirs
const graph = {
  nodes: [
    'G','O','T','E','R','W',
    'G-O','O-T','E-R','G-E','O-R','R-W',
    'couloir TP svt','couloir TP physique chimie'
  ],
  edges: {
    'G': ['G-O','G-E','couloir TP svt'],
    'O': ['G-O','O-T','O-R'],
    'T': ['O-T'],
    'E': ['G-E','E-R','couloir TP physique chimie'],
    'R': ['E-R','O-R','R-W'],
    'W': ['R-W'],
    'G-O': ['G','O'],
    'O-T': ['O','T'],
    'E-R': ['E','R'],
    'G-E': ['G','E'],
    'O-R': ['O','R'],
    'R-W': ['R','W'],
    'couloir TP svt': ['G'],
    'couloir TP physique chimie': ['E']
  }
};

// Lookup
function lookup(num){
  const floor=Math.floor(num/100);
  const groups=data[floor];
  if(!groups) return {floor,found:false};
  for(const g of groups){
    if(g.rooms.includes(num)){
      return {floor,found:true,stairs:g.stairs};
    }
  }
  return {floor,found:false};
}

function fmtFloor(f){return f===0?'RDC':(f===1?'1ᵉʳ étage': f+'ᵉ étage');}

// BFS
function findPath(start,end){
  const visited={};
  const queue=[[start]];
  while(queue.length){
    const path = queue.shift();
    const node = path[path.length-1];
    if(node===end) return path;
    visited[node]=true;
    for(const n of graph.edges[node]||[]){
      if(!visited[n]) queue.push([...path,n]);
    }
  }
  return [];
}

// Mettre en surbrillance

function highlightRoute(path){
  // Nettoyer les anciens surlignages
  document.querySelectorAll('.stair, .corridor').forEach(el=>el.classList.remove('route'));
  clearArrows(); // <- on enlève les anciennes flèches

  for(let i=0;i<path.length;i++){
    const stair = document.getElementById(path[i]);
    if(stair) stair.classList.add('route');

    if(i<path.length-1){
      const corridorId = path[i] + '-' + path[i+1];
      const corridorAlt = path[i+1] + '-' + path[i];
      let corridor = document.getElementById(corridorId) || document.getElementById(corridorAlt);

      if(corridor){
        corridor.classList.add('route');

        // Calcul de la direction
        let dir = null;
        const a = document.getElementById(path[i]);
        const b = document.getElementById(path[i+1]);
        if(a && b){
          const ax = a.offsetLeft, ay = a.offsetTop;
          const bx = b.offsetLeft, by = b.offsetTop;
          if(Math.abs(ax - bx) > Math.abs(ay - by)){
            dir = (bx > ax) ? "right" : "left";
          } else {
            dir = (by > ay) ? "down" : "up";
          }
        }

        // Ajouter la flèche
        addArrow(corridor, dir);
      }
    }
  }

  // Cas spéciaux couloirs TP
  const last = path[path.length-1];
  if(last === "couloir TP svt") {
    const g = document.getElementById("G");
    if(g) g.classList.add("route");
  }
  if(last === "couloir TP physique chimie") {
    const e = document.getElementById("E");
    if(e) e.classList.add("route");
  }
}
function clearArrows() {
  document.querySelectorAll(".arrow").forEach(el => el.remove());
}

function addArrow(corridor, dir) {
  const arrow = document.createElement("div");
  arrow.className = "arrow";

  // Position au centre du couloir
  arrow.style.left = (corridor.offsetLeft + corridor.offsetWidth/2 - 8) + "px";
  arrow.style.top  = (corridor.offsetTop + corridor.offsetHeight/2 - 8) + "px";

  // Choix de la flèche
  if (dir === "right") arrow.textContent = "→";
  if (dir === "left") arrow.textContent = "←";
  if (dir === "up") arrow.textContent = "↑";
  if (dir === "down") arrow.textContent = "↓";

  document.querySelector(".map-container").appendChild(arrow);
}

// Construire message
function buildMessage(target,from){
  const t=lookup(target);
  if(!t.found) return `<div class="error">Salle ${target} non répertoriée.</div>`;
  
  let html=`<div class="result">Salle <strong>${target}</strong> — ${fmtFloor(Math.floor(target/100))}<br/>
    Escalier/couloir : <strong>${t.stairs}</strong>.
  </div>`;

  if(from){
    const f=lookup(from);
    if(f.found){
      const route = findPath(f.stairs,t.stairs);
      html += `<div class="result">Itinéraire depuis la salle ${from}: ${route.join(' → ')}</div>`;
      highlightRoute(route);
    } else {
      highlightRoute([t.stairs]);
    }
  } else {
    highlightRoute([t.stairs]);
  }

  return html;
}

// Événements
const out=document.getElementById('out');
document.getElementById('go').onclick=()=>{
  const t=Number(document.getElementById('target').value.trim());
  const fVal=document.getElementById('from').value.trim();
  const f=fVal?Number(fVal):null;
  if(!t){out.innerHTML='<div class="error">Entre un numéro de salle.</div>';return;}
  out.innerHTML=buildMessage(t,f);
};
document.getElementById('reset').onclick=()=>{
  document.getElementById('target').value='';
  document.getElementById('from').value='';
  out.innerHTML='';
  highlightRoute([]);
};
</script>
</body>
</html>
